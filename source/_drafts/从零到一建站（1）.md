title: 从零到一建站（1）
author: 田_田
date: 2017-06-29 20:00:14
tags:
---
我现在想写一个从零到一建web 网站的教程。也想留下一个好的工程模板。

<!-- more -->

## 基本要求
### 设想
麻雀虽小，五脏俱全
- 用户邮件或者注册
- 每个用户看到自己的内容
- 就做经典的 todolist 吧
- 让用户之间可以共享文档
- 前后端做好分离，后端 restful，前端 SPA
- 加一点简单的 gis、短信或者其他的云服务。

### 后端
基本要求：
- 有一个舒服的框架来帮助实现路由绑定和分级、数据打包。
- 有一个好的 orm 插件，帮助处理80%以上的数据库细节
- 有一个好的表单验证插件，数据合法性尽可能直接使用配置
- 要能方便的实现 RESTFUL，方便实现oauth。
选型：
我自己非常熟悉 django，BOJv3和 BOJv4花费了大量的时间学习和开发，如果使用 pinax，可以使得开发非常快。但是 django 有点重，即使写过一遍，还是会花费极多的时间来看文档。

基本要求，要么测试覆盖率90%+，要么 github 千星以上。

这一次试试 golang，工作的时候用了半年的 gin。查了很久的资料，三件事分别使用三个不同插件，剩余的尽可能直接使用 golang 的内置实现。

- 框架选择 gin，赤兔用的框架，flask 风格，路由实现还可以，比对了其他的 beego 和 Gorilla、Revel等几个比较火的，用这个比较清爽的吧。
- Gorm：golang 体系里最火的 orm
- [validator](https://github.com/go-playground/validator): 一个测试覆盖率100%的项目。


### 前端
基本要求：
- 最好是 SPA，单页面应用。
- 使用好的打包工具与发布流程。

目前来说前端全家桶世界是三驾马车：Angular，React，Vue。
综合来说Angular最老，React人最多，Vue学习曲线最舒服。
打包工具选择 gulp 和 webpack，走在世界前列。

### 持续集成
基本要求：
- 前后端争取都把覆盖率做到85%+
- 放在 github，使用优雅的姿势，把三方的源码检测 icon 加进来
- 上线版本管理。
- 如果有机会，反作用于开源社区
这部分还没有想特别清楚。后期弄完了再专门写一篇文章。


## 开工
信仰不能变，JetBrains Gogland + Webstorm
流程类似这样[不和谐](http://www.jianshu.com/p/15e6f6ca335e)

跳转到定义可以直接 cmd+click，这一个功能就能大大提高开发效率。

前端包管理使用 NPM，后端包管理使用自带的vendor。不明白我在说啥的可以看看这个：[各种语言常见的包管理工具](https://www.tianmaying.com/tutorial/package-manager)


### 安装 Golang
官网下一个[安装包](https://golang.org/doc/install)
.zshrc 里加上环境变量
```
export GOROOT=/usr/local/go/
export PATH=$PATH:/usr/local/go/bin
```
正常情况看到这个就行
```
➜  todolist-backend git:(master) ✗ go version  
go version go1.8.3 darwin/amd64
```

### 使用 vendor 管理包
大致是先要指定一个 GOPATH，然后里面建一个 src 文件夹，然后再 src 文件夹里面建立工程。
```
cd /tmp/test/src
mkdir myproj
cd myproj
govendor init
```
这个时候出现一个vendor文件夹。

参考这个资料：[vendor的简要说明](https://golang.top/articles/9785)

### 安装  Gin
Gin 的官方地址是 gopkg.in/gin-gonic/gin.v1
```
govendor fetch gopkg.in/gin-gonic/gin.v1
```
此时 vendor 文件夹应该变了：
```
{
	"comment": "",
	"ignore": "test",
	"package": [
		{
			"checksumSHA1": "UsILDoIB2S7ra+w2fMdb85mX3HM=",
			...
		},
        ...
		{
			"checksumSHA1": "hT+7DPyl8tQ96kUXW3Sr5o0Pcj0=",
			"path": "gopkg.in/gin-gonic/gin.v1",
			"revision": "e2212d40c62a98b388a5eb48ecbdcf88534688ba",
			"revisionTime": "2016-12-04T22:13:08Z"
		},
        ...
	],
	"rootPath": "todolist-backend"
}
```
这里可以看到很多的包，很有意思，validator和我之前调研的居然是同一个。

### hello gin

这个时候吧 hello world拷贝到工程目录:
```
➜  todolist-backend git:(master) ✗ touch hello.go
```
内容：
```
package main

import "gopkg.in/gin-gonic/gin.v1"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080
}
```
运行之：
```
➜  todolist-backend git:(master) ✗ go run hello.go
```
浏览器打开`http://localhost:8080/ping`
可以看到`{"message":"pong"}`

后端基础安装工作完成！

